<template>
  <v-container>

    <!-- üîπ 2 ‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏Å‡∏±‡∏ô -->
    <v-row>
      <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ã‡πâ‡∏≤‡∏¢ : ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á) -->
      <v-col cols="6">
        <v-card class="pa-6">
          <h2 class="text-h6 mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h2>

          <v-text-field
            v-model="mainTopic.nametopic"
            label="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô"
            variant="outlined"
            :disabled="mainLocked"
          />

          <v-text-field
            v-model="mainTopic.dis"
            label="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠"
            variant="outlined"
            :disabled="mainLocked"
          />

          <v-btn
            color="primary"
            class="mt-4"
            block
            :disabled="mainLocked"
            @click="lockMainTopic"
          >
            {{ mainLocked ? '‡∏•‡πá‡∏≠‡∏Ñ‡πÅ‡∏•‡πâ‡∏ß' : '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠' }}
          </v-btn>
        </v-card>
      </v-col>

      <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏ß‡∏≤ : ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ) -->
      <v-col cols="6">
        <v-card class="pa-6">
          <h2 class="text-h6 mb-4">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>

          <v-text-field
            v-model="form.topic"
            label="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢"
            variant="outlined"
            :disabled="!mainLocked"
          />

          <v-text-field
            v-model="form.discrip"
            label="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢"
            variant="outlined"
            :disabled="!mainLocked"
          />

          <v-text-field
            v-model="form.score_add"
            label="‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"
            type="number"
            variant="outlined"
            :disabled="!mainLocked"
          />

          <v-select
            v-model="form.type"
            :items="type"
            label="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"
            variant="outlined"
            :disabled="!mainLocked"
          />

          <v-btn color="primary" class="mt-4" block @click="addToTable">
            ‡πÄ‡∏û‡∏¥‡πà‡∏°
          </v-btn>
        </v-card>
      </v-col>
    </v-row>

    <!-- üîπ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á -->
    <v-card class="mt-6">
      <v-toolbar flat>
        <v-toolbar-title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</v-toolbar-title>

        <v-spacer />

        <v-btn color="success" @click="submitToDB">
          ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        </v-btn>
      </v-toolbar>

      <v-data-table
        :headers="headers"
        :items="topics"
      >
        <template #item.actions="{ item }">
          <v-btn icon color="red" @click="deleteRow(item)">
            <v-icon>mdi-delete</v-icon>
          </v-btn>
        </template>
      </v-data-table>
    </v-card>

  </v-container>
</template>

<script setup>
import { ref } from 'vue'
import axios from 'axios'

/* Dropdown ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó */
const type = ref(['‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô', '‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô'])

/* ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) */
const mainTopic = ref({
  nametopic: '',
  dis: ''
})

const mainLocked = ref(false)

/* ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô */
const form = ref({
  topic: '',
  discrip: '',
  score_add: '',
  type: ''
})

/* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô */
const topics = ref([])

/* Header ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
const headers = [
  { title: '‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠', key: 'nametopic' },
  { title: '‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢', key: 'dis' },
  { title: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', key: 'score' },
  { title: '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó', key: 'type' },
  { title: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£', key: 'actions' }
]

/* ‡∏•‡πá‡∏≠‡∏Ñ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å */
const lockMainTopic = () => {
  if (!mainTopic.value.nametopic || !mainTopic.value.dis) {
    alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö')
    return
  }
  mainLocked.value = true
}

/* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
const addToTable = () => {
  if (!mainLocked.value) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô')
    return
  }

  if (!form.value.topic || !form.value.score_add || !form.value.type) {
    alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö')
    return
  }

  topics.value.push({
    nametopic: form.value.topic,
    dis: form.value.discrip,
    score: form.value.score_add,
    type: form.value.type
  })

  // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
  form.value = { topic: '', discrip: '', score_add: '', type: '' }
}

/* ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß */
const deleteRow = (item) => {
  topics.value = topics.value.filter(t => t !== item)
}

/* ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
const submitToDB = async () => {
  if (!mainLocked.value) {
    alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å')
    return
  }

  if (topics.value.length === 0) {
    alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô')
    return
  }

  try {
    await axios.post(
      'http://localhost:7000/api/admin/createperiod',
      {
        mainTopic: mainTopic.value,
        details: topics.value
      }
    )

    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ')

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    mainTopic.value = { nametopic: '', dis: '' }
    mainLocked.value = false
    topics.value = []
  } catch (err) {
    console.error(err)
    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ùå')
  }
}
</script>
